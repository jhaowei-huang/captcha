<!DOCTYPE html>

<html>
	<head>
		<title> CV Test </title>
		<link href="style.css" rel="stylesheet" type="text/css" />
		<script src = "jquery-2.1.1.js"></script>
		<script src = "jcanvas.js"></script>
		<script type="text/javascript" src="pixastic.core.js"></script>
		<script type="text/javascript" src="actions/desaturate.js"></script>
		<script type="text/javascript" src="actions/edges.js"></script>
		<script type="text/javascript" src="actions/edges2.js"></script>
		<script type="text/javascript">
				function edges(img) {
					var img2 = Pixastic.process(img, "edges");
					img2.onmouseout = function() {
						Pixastic.revert(this);
					}
				}
			</script>
		<p>
			<img src="images/input.gif" onmouseover="edges(this);" width = "300" height = "300"></img>
		</p>
		</script>
		<script type="text/javascript">
			$(document).ready(function(){
				var c, ctx, 
					img = new Image(), 
					intputImgURL,
					canvas,
					context,
					outputImgData;

				var w = document.getElementById("intputCanvas").width,
					h = document.getElementById("intputCanvas").height;

				$("#intputCanvas").drawImage({
				  	source: 'images/input.gif',
				  	x: w/2, y: h/2,
				  	width: w, height: h
				});

				$("#btn1").on("click", function() {
					c = document.getElementById("outputCanvas"); 
					// to get DOM object. It equals to " document.getElementById("outputCanvas"); ".
					ctx = c.getContext("2d");
					ctx.clearRect(0, 0, w, h);
					
          			intputImgURL = $("#intputCanvas").getCanvasImage(); // get input image as a DataURL
          			img.src = intputImgURL; // convert DataURL to image object

          			outputImgData = invert(img);
          			// imgData = effect(img, 1);
          			// ctx.drawImage(img, 0, 0); // draw on output canvas

          			// canvas = document.createElement('canvas'); // create an in memory canvas
          			// canvas.width = img.width; canvas.height = img.height; 
          			// /* important!! but I dont know why the output is not complete without this.
             //           I guess the canvas is create with a default width and height. The width 
             //           and height are not fit to the image. */
          
          			// context = canvas.getContext('2d');
          			// // var img = document.getElementById('myimg'); // the image which imageData you want to get.
          			// context.drawImage(img, 0, 0 );  // draw on in memory canvas
          			// imgData = context.getImageData(0, 0, img.width, img.height); // get imageData

          			// for(i = 0; i < imgData.data.length; i += 4) { // invert the img
            	// 		imgData.data[i] = 255 - imgData.data[i];
			          //   imgData.data[i + 1] = 255 - imgData.data[i + 1];
			          //   imgData.data[i + 2] = 255 - imgData.data[i + 2];
			          //   imgData.data[i + 3] = 255;
          			// }
          			
          			ctx.putImageData(outputImgData, 0,0); // draw on outputCanvas
				});
				
				function invert(img) {
					canvas = document.createElement('canvas'); // create an in memory canvas
	      			canvas.width = img.width; canvas.height = img.height; 
	          		
	          		context = canvas.getContext('2d');
	          		context.drawImage(img, 0, 0 );  // draw on in memory canvas
	          		imgData = context.getImageData(0, 0, img.width, img.height); // get imageData
	          		
	          	// 	for(i = 0; i < imgData.data.length; i += 4) { // invert the img
	        			// imgData.data[i] = 255 - imgData.data[i];
			         //    imgData.data[i + 1] = 255 - imgData.data[i + 1];
				        // imgData.data[i + 2] = 255 - imgData.data[i + 2];
			         //    imgData.data[i + 3] = 255;
	          	// 	}

	          		var x, y, i;
	          		// var dd = {};
	          		// $.extend(dd,imgData.data);
	          		var dd = new Object();
	          		dd = imgData.data;
	          		for(y = 0; y < imgData.height; y++) {
	          			for(x = 0; x < imgData.width; x++) {
	          				i = ((img.width * y) + x) * 4;
	          				dd[i] = 255 - imgData.data[i];
			            	dd[i + 1] = 255 - imgData.data[i + 1];
				        	dd[i + 2] = 255 - imgData.data[i + 2];
			            	dd[i + 3] = 255;
			            	// alert(i + " = " + dd[i] + "." + dd[i + 1] + "." + dd[i + 2] + "." + dd[i + 3]);
	          			}
	          		}
	          		// imgData.data = dd;
					return imgData;
				}

				
			});
		</script>	
			
	</head>

	<body>
		<table >
   			<tbody>
     			<tr>
       				<td id = "input"> Input <BR> <canvas id = "intputCanvas" width = "300" height = "300"></canvas> </td>
       				<td valign = "bottom" > <button id = "btn1"> Invert </button> </td>
       				<td id = "output"> Output <BR> <canvas id = "outputCanvas" width = "300" height = "300"></canvas> </td>
     			</tr>
  		 	</tbody>
 		</table>

	</body>
</html>